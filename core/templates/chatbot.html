{% extends 'base.html' %}

{% block content %}
<div id="chat-container" class="container my-5">
    <h2 class="text-center mb-4">Chat with Our Bot ðŸ¤–</h2>
    <div id="chat-messages" class="chat-box shadow-lg rounded p-3" style="height: 400px; overflow-y: scroll;">
        <!-- Chat messages will appear here -->
    </div>
    <form id="chat-form" class="input-group mt-3">
        {% csrf_token %}
        <input type="text" id="user-input" name="user_input" class="form-control" placeholder="Type your message..." aria-label="User input" autofocus>
        <button type="submit" class="btn btn-primary btn-gradient">Send</button>
    </form>
</div>

<script>
document.getElementById('chat-form').addEventListener('submit', function(e) {
    e.preventDefault();
    var userInput = document.getElementById('user-input').value.trim();
    var chatMessages = document.getElementById('chat-messages');
    
    if (userInput) {
        // Add user message to chat with animation
        chatMessages.innerHTML += '<div class="d-flex justify-content-end mb-3 fade-in"><div class="chat-bubble chat-bubble-user">' + userInput + '</div></div>';
        
        // Scroll to the bottom of the chat
        chatMessages.scrollTop = chatMessages.scrollHeight;
        
        // Clear input field
        document.getElementById('user-input').value = '';

        // Simulate typing indicator
        chatMessages.innerHTML += '<div id="typing-indicator" class="d-flex justify-content-start mb-3 fade-in"><div class="chat-bubble chat-bubble-bot typing">...</div></div>';
        chatMessages.scrollTop = chatMessages.scrollHeight;

        // Send request to server
        fetch('{% url "chatbot" %}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
                'X-CSRFToken': '{{ csrf_token }}'
            },
            body: 'user_input=' + encodeURIComponent(userInput)
        })
        .then(response => response.json())
        .then(data => {
            // Remove typing indicator
            document.getElementById('typing-indicator').remove();
            
            // Add bot response to chat with animation
            chatMessages.innerHTML += '<div class="d-flex justify-content-start mb-3 fade-in"><div class="chat-bubble chat-bubble-bot">' + data.response + '</div></div>';
            
            // Scroll to the bottom of the chat
            chatMessages.scrollTop = chatMessages.scrollHeight;
        });
    }
});
</script>

<style>
    /* Chat container styling */
    #chat-container {
        max-width: 700px;
        margin: auto;
    }

    /* Chat box styling */
    .chat-box {
        background: linear-gradient(135deg, #f9f9f9, #ffffff);
        border-radius: 15px;
        border: 1px solid #ddd;
    }

    /* Chat bubbles */
    .chat-bubble {
        padding: 12px 18px;
        border-radius: 15px;
        max-width: 70%;
        word-wrap: break-word;
        animation: fade-in 0.3s ease-in-out;
    }
    .chat-bubble-user {
        background-color: #007bff;
        color: white;
        align-self: flex-end;
    }
    .chat-bubble-bot {
        background-color: #f1f1f1;
        color: black;
        align-self: flex-start;
    }

    /* Typing indicator */
    .typing {
        background-color: #f1f1f1;
        font-weight: bold;
        color: #888;
        animation: blink 1s infinite;
    }

    /* Button gradient */
    .btn-gradient {
        background: linear-gradient(90deg, #007bff, #00bfff);
        border: none;
        color: white;
        padding: 0.5rem 1rem;
    }

    /* Fade-in animation for chat bubbles */
    @keyframes fade-in {
        0% { opacity: 0; transform: translateY(10px); }
        100% { opacity: 1; transform: translateY(0); }
    }

    /* Typing indicator animation */
    @keyframes blink {
        0% { opacity: 0.5; }
        50% { opacity: 1; }
        100% { opacity: 0.5; }
    }

    /* Chatbox scrollbar customization */
    #chat-messages {
        scrollbar-width: thin;
        scrollbar-color: #888 #f9f9f9;
    }
    #chat-messages::-webkit-scrollbar {
        width: 8px;
    }
    #chat-messages::-webkit-scrollbar-thumb {
        background-color: #007bff;
        border-radius: 10px;
    }
</style>
{% endblock %}
